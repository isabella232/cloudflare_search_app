<!doctype html>
<html>
<head>
<title>Hacky Test File</title>

<script type="text/javascript" src="http://ajax.cloudflare.com/cdn-cgi/nexp/cloudflare.js"></script>
<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.10.1/jquery.min.js"></script>
<script type="text/javascript">

// TODO: change to use cloudflare/loader, it's probably smaller
CloudFlare.define("swiftype", ["cloudflare/loader"],
                  function(foo) {
                    var addSwiftype = function(engineKey) {
                      window.Swiftype = window.Swiftype || {};
                      window.Swiftype.key = engineKey;

                      var script = document.createElement('script');
                      script.type = 'text/javascript';
                      script.async = true;
                      script.src = "//localhost:3000/embed.js";

                      var head = document.getElementsByTagName('head')[0];
                      head.appendChild(script);
                    };

                    $.getJSON("http://localhost:3000/cloudflare/domains?callback=?",
                              {domain_id: '90909'},
                              function(data) {
                                if (data.engine_key) {
                                  addSwiftype(data.engine_key);
                                }
                              });
                  }
);

</script>
</head>

<body>
<h1>Hacky Test File</h1>

<p>Will search appear?!</p>



</body>
</html>
